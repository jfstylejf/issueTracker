<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.fudan.measureservice.mapper.RepoMeasureMapper">

    <resultMap id="repoMeasure" type="RepoMeasure">
        <result property="files" column="files"/>
        <result property="ncss" column="ncss"/>
        <result property="classes" column="classes"/>
        <result property="functions" column="functions"/>
        <result property="ccn" column="ccn"/>
        <result property="java_docs" column="java_docs"/>
        <result property="java_doc_lines" column="java_doc_lines"/>
        <result property="single_comment_lines" column="single_comment_lines"/>
        <result property="multi_comment_lines" column="multi_comment_lines"/>
        <result property="developer_name" column="developer_name"/>
        <result property="developer_email" column="developer_email"/>
        <result property="add_lines" column="add_lines"/>
        <result property="del_lines" column="del_lines"/>
    </resultMap>

    <resultMap id="repoMeasureWithDate" type="RepoMeasure">
        <id property="uuid" column="uuid"/>
        <result property="files" column="files"/>
        <result property="ncss" column="ncss"/>
        <result property="classes" column="classes"/>
        <result property="functions" column="functions"/>
        <result property="ccn" column="ccn"/>
        <result property="java_docs" column="java_docs"/>
        <result property="java_doc_lines" column="java_doc_lines"/>
        <result property="single_comment_lines" column="single_comment_lines"/>
        <result property="multi_comment_lines" column="multi_comment_lines"/>
        <result property="commit_id" column="commit_id"/>
        <result property="commit_time" column="commit_time"/>
        <result property="repo_id" column="repo_id"/>
        <result property="developer_name" column="developer_name"/>
        <result property="developer_email" column="developer_email"/>
        <result property="add_lines" column="add_lines"/>
        <result property="del_lines" column="del_lines"/>
    </resultMap>

    <insert id="insertOneRepoMeasure" >
        insert into repo_measure
            (
               uuid,
               files,
               ncss,
               classes,
               functions,
               ccn,
               java_docs,
               java_doc_lines,
               single_comment_lines,
               multi_comment_lines,
               commit_id,
               commit_time,
               repo_id,
               developer_name,
               developer_email,
               add_lines,
               del_lines
            )
        values
           (
              #{uuid},
              #{files},
              #{ncss},
              #{classes},
              #{functions},
              #{ccn},
              #{java_docs},
              #{java_doc_lines},
              #{single_comment_lines},
              #{multi_comment_lines},
              #{commit_id},
              #{commit_time},
              #{repo_id},
              #{developer_name},
              #{developer_email},
              #{add_lines},
              #{del_lines}
           )
    </insert>

    <select id="sameMeasureOfOneCommit" resultType="int">
        select count(*) from repo_measure where repo_id = #{repo_id} and commit_id = #{commit_id}
    </select>

    <select id="getRepoMeasureByCommit" resultMap="repoMeasure">
        select
            files,ncss,classes,functions,ccn,java_docs,java_doc_lines,single_comment_lines,multi_comment_lines,developer_name,developer_email,add_lines,del_lines
        from repo_measure where repo_id = #{repo_id} and commit_id = #{commit_id}
    </select>

    <select id="getLatestMeasureData" resultMap="repoMeasure">
        select
            files,ncss,classes,functions,ccn,java_docs,java_doc_lines,single_comment_lines,multi_comment_lines,developer_name,developer_email,add_lines,del_lines
        from
            repo_measure
        where
            repo_id = #{repo_id}
        order by commit_time desc
        limit 1
    </select>

    <select id="getFirstMeasureDataAfterDuration" resultMap="repoMeasure">
         select
            files,ncss,classes,functions,ccn,java_docs,java_doc_lines,single_comment_lines,multi_comment_lines,developer_name,developer_email,add_lines,del_lines
        from
            repo_measure
        where
            repo_id = #{repo_id}   and  commit_time  &lt; #{time_line}
        order by commit_time desc
        limit 1
    </select>

    <select id="getRepoMeasureBetween" resultMap="repoMeasureWithDate">
        select * from repo_measure
        where repo_id = #{repo_id} and commit_time &gt; #{since} and commit_time &lt; #{until}
        order by commit_time;
    </select>
</mapper>